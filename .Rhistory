ggplot(df, aes(x=R,y=Ic)) +
geom_line() + geom_point()
ggplot(df, aes(x=R,y=Ic)) +
geom_line() + geom_point() +
lims(y=c(0,50))
ggplot(df, aes(x=R,y=Ic)) +
geom_line() + geom_point() +
lims(y=c(0,60))
ggplot(df, aes(x=R,y=Ic)) +
geom_line() + geom_point() +
lims(y=c(0,80))
ggplot(df, aes(x=R,y=Ic)) +
geom_line() + geom_point() +
lims(y=c(0,70))
las@data %>%
select(gpstime, Distance, Amplitude, Reflectance, Ic) %>%
pivot_longer(cols = Amplitude:Ic, names_to = 'measure') %>%
filter(measure != 'Amplitude') %>%
ggplot(aes(x = Distance, y = value, color=measure)) +
geom_point(alpha=0.1) +
geom_smooth() +
theme_bw()
df$Ic = ifelse(df$R<20, -F11(df$R), -F12(df$R))
ggplot(df, aes(x=R,y=Ic)) +
geom_line() + geom_point() +
lims(y=c(0,70))
ggplot(df, aes(x=R,y=Ic)) +
geom_line() + geom_point() +
lims(y=c(0,-70))
ggplot(df, aes(x=R,y=Ic)) +
geom_line() + geom_point() +
lims(y=c(-70,0))
las@data %>%
select(gpstime, Distance, Amplitude, Reflectance, Ic) %>%
pivot_longer(cols = Amplitude:Ic, names_to = 'measure') %>%
filter(measure != 'Amplitude') %>%
ggplot(aes(x = Distance, y = value, color=measure)) +
geom_point(alpha=0.1) +
geom_smooth() +
theme_bw()
df = las@data %>%
select(gpstime, Distance, Amplitude, Reflectance, Ic) %>%
pivot_longer(cols = Amplitude:Ic, names_to = 'measure') %>%
filter(measure != 'Amplitude')
df %>%
ggplot(aes(x = Distance, y = value, color=measure)) +
geom_point(alpha=0.1) +
geom_smooth() +
theme_bw() +
scale_x_log10()
df %>%
ggplot(aes(x = Distance, y = value, color=measure)) +
geom_point(alpha=0.1) +
geom_smooth() +
theme_bw() +
scale_x_log10() + lims(x=c(20,30))
df = las@data %>%
select(gpstime, Distance, Amplitude, Reflectance, Ic) %>%
pivot_longer(cols = Amplitude:Ic, names_to = 'measure')
df %>%
ggplot(aes(x = Distance, y = value, color=measure)) +
geom_point(alpha=0.1) +
geom_smooth() +
theme_bw() +
scale_x_log10() + lims(x=c(20,30))
df %>%
ggplot(aes(x = Distance, y = value, color=measure)) +
geom_point(alpha=0.1) +
geom_smooth() +
theme_bw() +
scale_x_log10() + lims(x=c(10,30))
Correct_Amplitude_Xu2017 = function(A, R) {
F11 = 1.623e-3*R^3 - 9.287e-2*R^2 +1.37*R + 25.88
F12 = 10*log(3.218e5/R^2)
Ic = ifelse(R < 20, F11, F12)
return(A + Ic)
}
Ic = Correct_Amplitude_Xu2017(las$Amplitude, las$Distance)
las = add_lasattribute(las, Ic, 'Ic', 'Corrected Reflectance')
plot(las, color='Reflectance', backend='lidRviewer')
las@data %>%
ggplot(aes(x=Amplitude, y = Ic)) +
geom_point(alpha=0.1) +
geom_smooth() +
theme_bw()
las@data %>%
filter(Ic > -25) %>%
ggplot(aes(x=Amplitude, y = Ic)) +
geom_point(alpha=0.1) +
geom_smooth() +
theme_bw()
# Is Ic any different than Reflectance?
las@data %>%
filter(Ic > -25) %>%
ggplot(aes(x=Reflectance, y = Ic)) +
geom_point(alpha=0.1) +
geom_smooth() +
theme_bw() +
geom_abline(slope=1,intercept = 0, color='red', linetype='dashed', size=1.5)
df = las@data %>%
select(gpstime, Distance, Amplitude, Reflectance, Ic) %>%
pivot_longer(cols = Amplitude:Ic, names_to = 'measure')
df %>%
ggplot(aes(x = Distance, y = value, color=measure)) +
geom_point(alpha=0.1) +
geom_smooth() +
theme_bw() +
scale_x_log10() + lims(x=c(10,30))
F11 = function(R) R^3*1.623e-3 - R^2*9.287e-22 + R*1.367 + 25.88
F12 = function(R) 10*log((3.218e5)/R^2)
df %>%
ggplot(aes(x = Distance, y = value, color=measure)) +
geom_point(alpha=0.1) +
geom_smooth() +
theme_bw() +
scale_x_log10() + lims(x=c(1,30))
df %>%
ggplot(aes(x = Distance, y = value, color=measure)) +
geom_point(alpha=0.1) +
geom_smooth() +
theme_bw() +
scale_x_log10() + lims(x=c(1,30)) +
lims(y = c(-25,40))
df %>%
ggplot(aes(x = Distance, y = value, color=measure)) +
geom_point(alpha=0.1) +
geom_smooth() +
theme_bw() +
scale_x_log10() + lims(x=c(1,630)) +
lims(y = c(-25,40))
df %>%
ggplot(aes(x = Distance, y = value, color=measure)) +
geom_point(alpha=0.01) +
geom_smooth() +
theme_bw() +
scale_x_log10() + lims(x=c(1,60)) +
lims(y = c(-25,40))
df %>%
filter(measure != 'Ic') %>%
ggplot(aes(x = Distance, y = value, color=measure)) +
geom_point(alpha=0.01) +
geom_smooth() +
theme_bw() +
scale_x_log10() + lims(x=c(1,60))
df %>%
filter(measure != 'Ic') %>%
ggplot(aes(x=value,color=measure)) +
facet_wrap(~measure)
df %>%
filter(measure != 'Ic') %>%
ggplot(aes(x=value,color=measure)) +
facet_wrap(~measure) +
geom_histogram( )
las@data %>%
ggplot(aes(y=Intensity, x=Refelectance)) + geom_point()
las@data %>%
ggplot(aes(y=Intensity, x=Reflectance)) + geom_point()
lm(Reflectance ~ Itensity, data = las@data)
lm(Reflectance ~ Intesity, data = las@data)
lm(Reflectance ~ Intensity, data = las@data)
mod = lm(Reflectance ~ Intensity, data = las@data)
plot(Reflectance ~ Ampitude + Distance)
lm(Reflectance ~ Ampitude + Distance)
lm(Reflectance ~ Ampitude + Distance, data = las@data)
lm(Reflectance ~ Amplitude + Distance, data = las@data)
mod = lm(Reflectance ~ Amplitude + Distance, data = las@data)
mod
summary(mod)
mod = lm(Reflectance ~ Amplitude + 1/Distance, data = las@data)
mod
summary(mod)
fn = formula(Reflectance ~ Amplitude)
mod = lm(fn, data = las@data)
plot(fn, data=las@data)
mod = lm(Reflectance ~ Intensity, data = las@data)
summary(mod)
4.578e-4-2.5
4.578e-4 * 45000 -2.5
-2.5 + 4.578e-4 * 45000
las@data %>%
ggplot(aes(y=Intensity, x=Reflectance)) + geom_point()
las@data %>%
ggplot(aes(y=Reflectance, x=Intensity)) + geom_point()
mod = lm(Reflectance ~ Intensity, data = las@data)
summary(mod)
(4.578e-4 * 45000 )
mod = lm(Reflectance ~ Intensity, data = las@data)
summary(mod)
-2.5 + (4.578e-4 * 40000)
-25 + (4.578e-4 * 40000)
-25 + (4.578e-4 * 41000)
-25 + (4.578e-4 * 45000)
F11 = function(R) R^3*1.623e-3 - R^2*9.287e-2 + R*1.367 + 25.88
F12 = function(R) 10*log((3.218e5)/R^2)
df = data.frame(R = 0:60)
df$Ic = ifelse(df$R<20, -F11(df$R), -F12(df$R))
ggplot(df, aes(x=R,y=Ic)) +
geom_line() + geom_point() +
lims(y=c(-70,0))
F12 = function(R) 10*log((3.218e-5)/R^2)
df = data.frame(R = 0:60)
df$Ic = ifelse(df$R<20, -F11(df$R), -F12(df$R))
ggplot(df, aes(x=R,y=Ic)) +
geom_line() + geom_point() +
lims(y=c(-70,0))
F12 = function(R) 10*log((3.218e5)/R^2)
df = data.frame(R = 0:60)
df$Ic = ifelse(df$R<20, -F11(df$R), -F12(df$R))
ggplot(df, aes(x=R,y=Ic)) +
geom_line() + geom_point() +
lims(y=c(-70,0))
F12 = function(R) 10*log((3.218e5, base=10)/R^2)
F12 = function(R) 10*log((3.218e5)/R^2, base=10)
df = data.frame(R = 0:60)
df$Ic = ifelse(df$R<20, -F11(df$R), -F12(df$R))
ggplot(df, aes(x=R,y=Ic)) +
geom_line() + geom_point() +
lims(y=c(-70,0))
F12 = function(R) 10*log10((3.218e5)/R^2)
df = data.frame(R = 0:60)
df$Ic = ifelse(df$R<20, -F11(df$R), -F12(df$R))
ggplot(df, aes(x=R,y=Ic)) +
geom_line() + geom_point() +
lims(y=c(-70,0))
Correct_Amplitude_Xu2017 = function(A, R) {
F11 = 1.623e-3*R^3 - 9.287e-2*R^2 +1.37*R + 25.88
F12 = 10*log(3.218e5/R^2, base=10)
Ic = ifelse(R < 20, F11, F12)
return(A + Ic)
}
Ic = Correct_Amplitude_Xu2017(las$Amplitude, las$Distance)
las = add_lasattribute(las, Ic, 'Ic', 'Corrected Reflectance')
plot(las, color='Reflectance', backend='lidRviewer')
las@data %>%
ggplot(aes(x=Amplitude, y = Ic)) +
geom_point(alpha=0.1) +
geom_smooth() +
theme_bw()
Ic = Correct_Amplitude_Xu2017(las$Amplitude, las$Distance)
las = add_lasattribute(las, Ic, 'Ic', 'Corrected Reflectance')
las@data %>%
ggplot(aes(x=Amplitude, y = Ic)) +
geom_point(alpha=0.1) +
geom_smooth() +
theme_bw()
las@data %>%
filter(Ic > -25) %>%
ggplot(aes(x=Amplitude, y = Ic)) +
geom_point(alpha=0.1) +
geom_smooth() +
theme_bw()
# Is Ic any different than Reflectance?
las@data %>%
filter(Ic > -25) %>%
ggplot(aes(x=Reflectance, y = Ic)) +
geom_point(alpha=0.1) +
geom_smooth() +
theme_bw() +
geom_abline(slope=1,intercept = 0, color='red', linetype='dashed', size=1.5)
return(A - Ic)
Correct_Amplitude_Xu2017 = function(A, R) {
F11 = 1.623e-3*R^3 - 9.287e-2*R^2 +1.37*R + 25.88
F12 = 10*log(3.218e5/R^2, base=10)
Ic = ifelse(R < 20, F11, F12)
return(A - Ic)
}
Ic = Correct_Amplitude_Xu2017(las$Amplitude, las$Distance)
las = add_lasattribute(las, Ic, 'Ic', 'Corrected Reflectance')
plot(las, color='Reflectance', backend='lidRviewer')
F11 = function(R) R^3*1.623e-3 - R^2*9.287e-2 + R*1.367 + 25.88
F12 = function(R) 10*log10((3.218e5)/R^2)
df = data.frame(R = 0:60)
df$Ic = ifelse(df$R<20, -F11(df$R), -F12(df$R))
ggplot(df, aes(x=R,y=Ic)) +
geom_line() + geom_point() +
lims(y=c(-70,0))
Correct_Amplitude_Xu2017 = function(A, R) {
F11 = 1.623e-3*R^3 - 9.287e-2*R^2 +1.37*R + 25.88
F12 = 10*log(3.218e5/R^2, base=10)
Ic = ifelse(R < 20, F11, F12)
return(A - Ic)
}
Ic = Correct_Amplitude_Xu2017(las$Amplitude, las$Distance)
las = add_lasattribute(las, Ic, 'Ic', 'Corrected Reflectance')
plot(las, color='Reflectance', backend='lidRviewer')
las@data %>%
ggplot(aes(x=Amplitude, y = Ic)) +
geom_point(alpha=0.1) +
geom_smooth() +
theme_bw()
las@data %>%
filter(Ic > -25) %>%
ggplot(aes(x=Amplitude, y = Ic)) +
geom_point(alpha=0.1) +
geom_smooth() +
theme_bw()
# Is Ic any different than Reflectance?
las@data %>%
filter(Ic > -25) %>%
ggplot(aes(x=Reflectance, y = Ic)) +
geom_point(alpha=0.1) +
geom_smooth() +
theme_bw() +
geom_abline(slope=1,intercept = 0, color='red', linetype='dashed', size=1.5)
df = las@data %>%
select(gpstime, Distance, Amplitude, Reflectance, Ic) %>%
pivot_longer(cols = Amplitude:Ic, names_to = 'measure')
df %>%
filter(measure != 'Ic') %>%
ggplot(aes(x = Distance, y = value, color=measure)) +
geom_point(alpha=0.01) +
geom_smooth() +
theme_bw() +
scale_x_log10() + lims(x=c(1,60))
# Is Ic any different than Reflectance?
las@data %>%
filter(Ic > -25) %>%
ggplot(aes(x=Reflectance, y = Ic)) +
geom_point(alpha=0.1) +
geom_smooth() +
theme_bw() +
geom_abline(slope=1,intercept = 0, color='red', linetype='dashed', size=1.5)
df = las@data %>%
select(gpstime, Distance, Amplitude, Reflectance, Ic) %>%
pivot_longer(cols = Amplitude:Ic, names_to = 'measure')
df %>%
filter(measure != 'Ic') %>%
ggplot(aes(x = Distance, y = value, color=measure)) +
geom_point(alpha=0.01) +
geom_smooth() +
theme_bw() +
scale_x_log10() + lims(x=c(1,60))
df = las@data %>%
select(gpstime, Distance, Amplitude, Reflectance, Ic) %>%
pivot_longer(cols = Amplitude:Ic, names_to = 'measure')
head(df)
df = las@data
#Corrected intensity  From Xu et al. 2017
F11 = function(R) R^3*1.623e-3 - R^2*9.287e-2 + R*1.367 + 25.88
F12 = function(R) 10*log10((3.218e5)/R^2)
df = data.frame(R = 0:60)
df$Ic = ifelse(df$R<20, -F11(df$R), -F12(df$R))
ggplot(df, aes(x=R,y=Ic)) +
geom_line() + geom_point() +
lims(y=c(-70,0))
df$`Amplitude correction` = ifelse(df$R<20, -F11(df$R), -F12(df$R))
ggplot(df, aes(x=R,y=`Amplitude correction`)) +
geom_line() + geom_point() +
lims(y=c(-70,0))
ggplot(df, aes(x=R,y=`Amplitude correction`)) +
geom_line() + geom_point() +
lims(y=c(-70,0)) + labs(x='Distance (m)')
df = data.frame(R = 0:60)
df$F1 = ifelse(df$R<20, -F11(df$R), -F12(df$R))
ggplot(df, aes(x=R,y=F1)) +
geom_line() + geom_point() +
lims(y=c(-70,0)) + labs(x='Distance (m)',)
ggplot(df, aes(x=R,y=F1)) +
geom_line() + geom_point() +
lims(y=c(-70,0)) + labs(x='Distance (m)', y = 'Amplitude correction (dB)')
ggplot(df, aes(x=R,y=F1)) +
geom_line() + geom_point() +
lims(y=c(-70,0)) + labs(x='Distance (m)', y = 'Amplitude correction (dB)') +
theme_bw()
ggplot(df, aes(x=R,y=F1)) +
geom_line() + geom_point() +
lims(y=c(-40,0)) + labs(x='Distance (m)', y = 'Amplitude correction (dB)') +
theme_bw()
ggplot(df, aes(x=R,y=F1)) +
geom_line() + geom_point() +
labs(x='Distance (m)', y = 'Amplitude correction (dB)') +
theme_bw()
ggplot(df, aes(x=R,y=F1)) +
geom_line() + geom_point() +
lims(y=c(-40,0)) + labs(x='Distance (m)', y = 'Amplitude correction (dB)') +
theme_bw()
ggplot(df, aes(x=R,y=F1)) +
geom_line() + geom_point() +
lims(y=c(-40,-10)) + labs(x='Distance (m)', y = 'Amplitude correction (dB)') +
theme_bw()
ggplot(df, aes(x=R,y=F1)) +
geom_line() +
lims(y=c(-40,-10)) + labs(x='Distance (m)', y = 'Amplitude correction (dB)') +
theme_bw()
Correct_Amplitude_Xu2017 = function(A, R) {
F11 = 1.623e-3*R^3 - 9.287e-2*R^2 +1.37*R + 25.88
F12 = 10*log(3.218e5/R^2, base=10)
Ic = ifelse(R < 20, F11, F12)
return(A - Ic)
}
Ic = Correct_Amplitude_Xu2017(las$Amplitude, las$Distance)
las = add_lasattribute(las, Ic, 'Ic', 'Corrected Reflectance')
las@data %>%
ggplot(aes(x=Amplitude, y = Ic)) +
geom_point(alpha=0.1) +
geom_smooth() +
theme_bw()
# Because detection threshold is at -25dB, may want to delete anything lower than that.
las@data %>%
filter(Ic > -25) %>%
ggplot(aes(x=Amplitude, y = Ic)) +
geom_point(alpha=0.1) +
geom_smooth() +
theme_bw()
# Is the Ic i cacluated any different from provided Refelectance? If not, the provided reflectance is all good. IF not, I hope to see that Ic is LOWER than Reflectance at short distances
las@data %>%
ggplot(aes(x=Amplitude, y = Ic)) +
geom_point(alpha=0.1) +
geom_smooth() +
theme_bw()
# Is the Ic i cacluated any different from provided Refelectance? If not, the provided reflectance is all good. IF not, I hope to see that Ic is LOWER than Reflectance at short distances
# Because detection threshold is at -25dB, may want to delete anything lower than that.
las@data %>%
filter(Ic > -25) %>%
ggplot(aes(x=Amplitude, y = Ic)) +
geom_point(alpha=0.1) +
geom_smooth() +
theme_bw()
# Show how Amplitude was changed with correction..
las@data %>%
filter(Ic > -25) %>%
ggplot(aes(x=Amplitude, y = Ic)) +
geom_point(alpha=0.1) +
geom_smooth() +
theme_bw()
# Is Ic any different than Reflectance?
las@data %>%
filter(Ic > -25) %>%
ggplot(aes(x=Reflectance, y = Ic)) +
geom_point(alpha=0.1) +
geom_smooth() +
theme_bw() +
geom_abline(slope=1,intercept = 0, color='red', linetype='dashed', size=1.5)
df = las@data
head(df)
df$diff = df$Reflectance - df$Ic
ggplot(df, aes(y=df, x = Distance)) +
geom_point()
ggplot(df, aes(y=diff, x = Distance)) +
geom_point()
ggplot(df, aes(y=diff, x = Distance)) +
geom_point(alpha = 0.1)
ggplot(df, aes(y=diff, x = Distance)) +
geom_point(alpha = 0.05)
ggplot(df, aes(y=diff, x = Distance)) +
geom_point(alpha = 0.05) + theme_bw()
ggplot(df, aes(y=diff, x = Distance)) +
geom_point(alpha = 0.05) + theme_bw() +
labs() +
geom_smooth()
ggplot(df, aes(y=diff, x = Distance)) +
geom_point(alpha = 0.05) + theme_bw() +
labs(y = expression(Reflectance - Amplitude[corrected])) +
# Indeed, that is the case, so we should be adding the improvement.
las@data %>%
ggplot(aes(y=Reflectance, x=Intensity)) + geom_point()
ggplot(df, aes(y=diff, x = Distance)) +
geom_point(alpha = 0.05) + theme_bw() +
labs(y = expression(Reflectance - Amplitude[corrected]))
ggplot(df, aes(y=diff, x = Distance)) +
geom_point(alpha = 0.05) + theme_bw() +
labs(y = expression(Reflectance - Amplitude[corrected]),
x = Distance (m))
ggplot(df, aes(y=diff, x = Distance)) +
geom_point(alpha = 0.05) + theme_bw() +
labs(y = expression(Reflectance - Amplitude[corrected]),
x = 'Distance (m)')
las_fn = 'X:/testing_density/ScanPos012 - SINGLESCANS - 230925_155852.laz'
las = readLAS(las_fn, filter='-keep_every_nth 1000')
las = lidR::readLAS(las_fn, filter='-keep_every_nth 1000')
class(las)
class(las) == 'LAS'
stopifnot(class(las) == 'LAS')
colnames(las@data)
'Amplitude' %in% colnames(las@data)
stopifnot(class(las) == 'LAS')
stopifnot('Amplitude' %in% colnames(las@data))
stopifnot('Distance' %in% colnames(las@data))
las = lidR::remove_lasattribute(las, 'Distance')
stopifnot('Amplitude' %in% colnames(las@data))
stopifnot('Distance' %in% colnames(las@data))
las = lidR::readLAS(las_fn, filter='-keep_every_nth 1000')
R = las$Distance
stopifnot(class(las) == 'LAS')
stopifnot('Amplitude' %in% colnames(las@data))
stopifnot('Distance' %in% colnames(las@data))
R = las$Distance
A = las$Amplitude
F11 = 1.623e-3*R^3 - 9.287e-2*R^2 +1.37*R + 25.88
F12 = 10*log(3.218e5/R^2, base=10)
# Piecewise distance-base correction alogrith (F1) from Xu et al. 2017 Rem. Sens.
F11 = 1.623e-3*R^3 - 9.287e-2*R^2 +1.37*R + 25.88
F12 = 10*log(3.218e5/R^2, base=10)
Ic = ifelse(R < 20, F11, F12)
Ic < -25
sum(Ic < -25)
hist(Ic)
30-30
30-Ic
hist(las$Reflectance)
las$Amplitude
plot(las$Reflectance ~ las$Amplitude)
max(las$Amplitude)
plot(las$Reflectance ~ las$Amplitude,asp=1)
plot(las$Reflectance ~ las$Amplitude -30,asp=1)
plot(las$Reflectance ~ I(las$Amplitude -30),asp=1)
library(landecoutils)
las_fn = 'X:/testing_density/ScanPos012 - SINGLESCANS - 230925_155852.laz'
las = lidR::readLAS(las_fn, filter='-keep_every_nth 1000')
corr = Correct_Amplitude_Xu2017(las)
hist(corr)
?Correct_Amplitude_Xu2017
